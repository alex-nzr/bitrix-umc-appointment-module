{"version":3,"file":"bx_popup.bundle.js","sources":["../src/scripts/utils/functions.js","../src/scripts/utils/eventManager.js","../src/scripts/utils/renderer.js","../src/types/params.js","../src/scripts/appointment/app.js","../src/scripts/index.js"],"sourcesContent":["//@flow\r\n/**\r\n * ==================================================\r\n * Developer: Alexey Nazarov\r\n * E-mail: jc1988x@gmail.com\r\n * Copyright (c) 2019 - 2022\r\n * ==================================================\r\n * \"Bit.Umc - Bitrix integration\" - functions.js\r\n * 10.07.2022 22:37\r\n * ==================================================\r\n */\r\n\r\n/**\r\n * add phone mask\r\n * @param input\r\n * @param mask\r\n */\r\nexport function maskInput(input: HTMLInputElement, mask: string): void\r\n{\r\n    const value = input.value;\r\n    const literalPattern = /[0]/;\r\n    const numberPattern = /[0-9]/;\r\n\r\n    let newValue = \"\";\r\n\r\n    let valueIndex = 0;\r\n\r\n    for (let i = 0; i < mask.length; i++) {\r\n        if (i >= value.length) break;\r\n        if (mask[i] === \"0\" && !numberPattern.test(value[valueIndex])) break;\r\n        while (!literalPattern.test(mask[i])) {\r\n            if (value[valueIndex] === mask[i]) break;\r\n            newValue += mask[i++];\r\n        }\r\n        newValue += value[valueIndex++];\r\n    }\r\n\r\n    input.value = newValue;\r\n}\r\n\r\nexport function convertHexToHsl(hex: string): any {\r\n    const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n\r\n    if (result)\r\n    {\r\n        let r = parseInt(result[1], 16);\r\n        let g = parseInt(result[2], 16);\r\n        let b = parseInt(result[3], 16);\r\n\r\n        r /= 255; g /= 255; b /= 255;\r\n        const max = Math.max(r, g, b), min = Math.min(r, g, b);\r\n        let h = 0, s, l = (max + min) / 2;\r\n\r\n        if (max === min) {\r\n            h = s = 0; // achromatic\r\n        } else {\r\n            const d = max - min;\r\n            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n            switch (max) {\r\n                case r:\r\n                    h = (g - b) / d + (g < b ? 6 : 0);\r\n                    break;\r\n                case g:\r\n                    h = (b - r) / d + 2;\r\n                    break;\r\n                case b:\r\n                    h = (r - g) / d + 4;\r\n                    break;\r\n            }\r\n            h /= 6;\r\n        }\r\n\r\n        s = s*100;\r\n        s = Math.round(s);\r\n        l = l*100;\r\n        l = Math.round(l);\r\n        h = Math.round(360*h);\r\n\r\n        //`hsl(${h}, ${s}%, ${l}%)`\r\n        return {\r\n            h: h,\r\n            s: `${s}%`,\r\n            l: `${l}%`,\r\n        };\r\n    }\r\n    return null;\r\n}","/**\r\n * ==================================================\r\n * Developer: Alexey Nazarov\r\n * E-mail: jc1988x@gmail.com\r\n * Copyright (c) 2019 - 2022\r\n * ==================================================\r\n * \"Bit.Umc - Bitrix integration\" - eventManager.js\r\n * 10.07.2022 22:37\r\n * ==================================================\r\n */\r\nimport {Event} from 'main.core';\r\n\r\nexport class EventManager extends Event.EventEmitter{\r\n    static clinicsLoaded = 'BX.Anz.Appointment:clinicsLoaded';\r\n    static employeesLoaded = 'BX.Anz.Appointment:employeesLoaded';\r\n    static nomenclatureLoaded = 'BX.Anz.Appointment:nomenclatureLoaded';\r\n    static scheduleLoaded = 'BX.Anz.Appointment:scheduleLoaded';\r\n    static fullDataLoaded  = 'BX.Anz.Appointment:dataLoaded';\r\n    static clinicsRendered = 'BX.Anz.Appointment:clinicsRendered';\r\n    static formStepChanged  = 'BX.Anz.Appointment:formStepChanged';\r\n\r\n    static bind(target: Element, eventName: string, handler: (event: Event) => void, options?: {\r\n        capture?: boolean,\r\n        once?: boolean,\r\n        passive?: boolean,\r\n    }): void{\r\n        Event.bind(target, eventName, handler, options);\r\n    }\r\n}","/**\r\n * ==================================================\r\n * Developer: Alexey Nazarov\r\n * E-mail: jc1988x@gmail.com\r\n * Copyright (c) 2019 - 2022\r\n * ==================================================\r\n * \"Bit.Umc - Bitrix integration\" - renderer.js\r\n * 10.07.2022 22:37\r\n * ==================================================\r\n */\r\nimport styles from \"../../styles/app.css\";\r\n\r\nexport class Renderer\r\n{\r\n    constructor(styles, application){\r\n        this.styles = styles;\r\n        this.application = application;\r\n    }\r\n\r\n    getAppHtmlSkeleton()\r\n    {\r\n        return BX.create('div', {\r\n            attrs: {\r\n                id: this.application.selectors.overlayId,\r\n                className: this.styles['appointment-popup-overlay']\r\n            },\r\n            children: [\r\n                BX.create('form', {\r\n                    attrs: {\r\n                        id: this.application.selectors.formId,\r\n                        className: this.styles['appointment-form']\r\n                    },\r\n                    children: [\r\n                        this.getLogoBlock(),\r\n                        this.getCloseButton(),\r\n                        this.getFormFirstBlock(),\r\n                        this.getFormSecondBlock(),\r\n                        this.getFormUserDataBlock(),\r\n                        this.getFormMessageBlock(),\r\n                        this.getFormPrivacyBlock(),\r\n                        this.getFormResultBlock(),\r\n                        this.getFormLoaderBlock(),\r\n                    ]\r\n                })\r\n            ]\r\n        });\r\n    }\r\n\r\n    getLogoBlock(){\r\n        return BX.create('div', {\r\n            attrs: {\r\n                className: this.styles['appointment-form-head'],\r\n            },\r\n            children: [\r\n                this.application.companyLogo ?\r\n                    BX.create('img', {\r\n                        attrs: {\r\n                            className: this.styles['appointment-form-head-logo'],\r\n                            src: this.application.companyLogo,\r\n                            alt: 'company logo',\r\n                        },\r\n                    })\r\n                : '',\r\n            ]\r\n        });\r\n    }\r\n\r\n    getCloseButton(){\r\n        return BX.create('span', {\r\n            attrs: {\r\n                id: this.styles['appointment-form-close'],\r\n            },\r\n            html: '&#10006;'\r\n        });\r\n    }\r\n\r\n    getFormFirstBlock(){\r\n        const doctorBtn = this.getFormBtn(BX.message(\"ANZ_JS_FORM_BTN_DOCTOR_FIRST\"), () => {\r\n            this.application.setSelectionDoctorBeforeService(true);\r\n        });\r\n        const serviceBtn = this.getFormBtn(BX.message(\"ANZ_JS_FORM_BTN_SERVICE_FIRST\"), () => {\r\n            this.application.setSelectionDoctorBeforeService(false);\r\n        });\r\n\r\n        const buttons = this.application.useServices ? [doctorBtn, serviceBtn] : [doctorBtn];\r\n\r\n        return BX.create('div', {\r\n            attrs: {\r\n                className: styles['appointment-form-step'],\r\n                id: this.application.selectors.formStepIds.one\r\n            },\r\n            dataset: {\r\n                services: !this.application.useServices ? 'disabled' : false\r\n            },\r\n            children: [\r\n                ...(this.getSelectionNodes(\r\n                    [this.application.dataKeys.clinicsKey, this.application.dataKeys.specialtiesKey]\r\n                )),\r\n                this.getFormButtonsBlock(buttons)\r\n            ]\r\n        });\r\n    }\r\n\r\n    getFormSecondBlock(){\r\n        const btnPrev = this.getFormBtn(BX.message('ANZ_JS_FORM_BTN_PREV'), () => {\r\n            this.application.changeFormStep(this.application.formStepNodes.one, true);\r\n        }, false, true);\r\n        const btnNext = this.getFormBtn(BX.message('ANZ_JS_FORM_BTN_NEXT'), () => {\r\n            this.application.changeFormStep(this.application.formStepNodes.userData);\r\n        });\r\n        return BX.create('div', {\r\n            attrs: {\r\n                className: `${styles['appointment-form-step']} ${styles['hidden']}`,\r\n                id: this.application.selectors.formStepIds.two\r\n            },\r\n            children: [\r\n                ...(this.getSelectionNodes([\r\n                    this.application.dataKeys.employeesKey,\r\n                    this.application.useServices ? this.application.dataKeys.servicesKey : null,\r\n                    this.application.dataKeys.scheduleKey\r\n                ])),\r\n                this.getFormButtonsBlock([btnPrev, btnNext])\r\n            ]\r\n        });\r\n    }\r\n\r\n    getFormUserDataBlock(){\r\n        return BX.create('div', {\r\n            attrs: {\r\n                className: `${styles['appointment-form-step']} ${styles['hidden']}`,\r\n                id: this.application.selectors.formStepIds.userData\r\n            },\r\n            children: [\r\n                ...(this.getTextNodes()),\r\n                this.getFormButtonsBlock([this.getFormSubmitBtn()])\r\n            ]\r\n        });\r\n    }\r\n\r\n    getFormMessageBlock(){\r\n        return BX.create('p', {\r\n            attrs: {\r\n                id: this.application.selectors.messageNodeId,\r\n            },\r\n        });\r\n    }\r\n\r\n    getFormButtonsBlock(buttons: HTMLElement[]){\r\n        return BX.create('div', {\r\n            attrs: {\r\n                className: this.styles['appointment-form-button-wrapper'],\r\n            },\r\n            children: buttons\r\n        });\r\n    }\r\n\r\n    getFormSubmitBtn(){\r\n        return BX.create('button', {\r\n            attrs: {\r\n                type: \"submit\",\r\n                id: this.application.selectors.submitBtnId,\r\n                className: this.styles['appointment-form-button'],\r\n            },\r\n            dataset: {\r\n                \"readonly\": \"Y\"\r\n            },\r\n            text: BX.message('ANZ_JS_FORM_BTN_TEXT')\r\n        });\r\n    }\r\n\r\n    getFormBtn(text: string, handler: Function, disabled: boolean = true, readonly = false){\r\n        return BX.create('button', {\r\n            attrs: {\r\n                type: \"button\",\r\n                className: this.styles['appointment-form-button'],\r\n                disabled: disabled\r\n            },\r\n            dataset: {\r\n                \"readonly\": readonly ? \"Y\" : \"N\"\r\n            },\r\n            text: text,\r\n            events: {\r\n                click: handler\r\n            }\r\n        });\r\n    }\r\n\r\n    getFormPrivacyBlock(){\r\n        return BX.create('p', {\r\n            attrs: {\r\n                className: this.styles['appointment-info-message'],\r\n            },\r\n            children: [\r\n                BX.create('span', {\r\n                    text: `${BX.message('ANZ_JS_FORM_CONFIRM_INFO_TEXT')} `\r\n                }),\r\n                BX.create('a', {\r\n                    attrs: {\r\n                        href: this.application.initParams['privacyPageLink'],\r\n                        target: '_blank'\r\n                    },\r\n                    text: BX.message('ANZ_JS_FORM_CONFIRM_INFO_LINK')\r\n                }),\r\n            ]\r\n        });\r\n    }\r\n\r\n    getFormResultBlock(){\r\n        return BX.create('div', {\r\n            attrs: {\r\n                id: this.application.selectors.appResultBlockId\r\n            },\r\n            children: [\r\n                BX.create('p', {\r\n                    text: ''\r\n                }),\r\n            ]\r\n        });\r\n    }\r\n\r\n    getFormLoaderBlock(){\r\n        return BX.create('div', {\r\n            attrs: {\r\n                className: this.styles['default-loader-wrapper']\r\n            },\r\n            html: `<svg class=\"${this.styles['default-loader-circular']}\" viewBox=\"25 25 50 50\">\r\n                     <circle class=\"${this.styles['default-loader-path']}\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-miterlimit=\"10\"></circle>\r\n                   </svg>`\r\n        });\r\n    }\r\n\r\n    getSelectionNodes(blockKeys: string[])\r\n    {\r\n        const arNodes = [];\r\n        blockKeys.length && blockKeys.forEach(key => {\r\n            if (!this.application.selectionBlocks.hasOwnProperty(key)){\r\n                return;\r\n            }\r\n\r\n            const selected = BX.create('p', {\r\n                attrs: {\r\n                    id: this.application.selectionBlocks[key].selectedId,\r\n                    className: this.styles['selection-item-selected']\r\n                },\r\n                text: this.application.defaultText[key],\r\n                events: {\r\n                    click: () => this.application.toggleSelectionList(key, selected, list)\r\n                }\r\n            });\r\n            const list = BX.create('ul', {\r\n                attrs: {\r\n                    id: this.application.selectionBlocks[key].listId,\r\n                    className: `${this.styles['selection-item-list']}`\r\n                },\r\n                text: this.application.defaultText[key]\r\n            });\r\n            const input = BX.create('input', {\r\n                attrs: {\r\n                    id: this.application.selectionBlocks[key].inputId,\r\n                    name: this.application.selectionBlocks[key].inputId,\r\n                    type: 'hidden',\r\n                }\r\n            });\r\n\r\n            const additionalClass = (key === this.application.dataKeys.clinicsKey) ? '' : this.styles['disabled'];\r\n            arNodes.push(\r\n                BX.create('div', {\r\n                    attrs: {\r\n                        id: this.application.selectionBlocks[key].blockId,\r\n                        className: `${this.styles['selection-block']} ${additionalClass}`\r\n                    },\r\n                    children: [ selected, list, input ]\r\n                })\r\n            );\r\n        });\r\n        return arNodes;\r\n    }\r\n\r\n    getTextNodes() {\r\n        const arNodes = [];\r\n\r\n        for(const key in this.application.initParams['textBlocks'])\r\n        {\r\n            if (!this.application.initParams['textBlocks'].hasOwnProperty(key)){\r\n                continue;\r\n            }\r\n            arNodes.push(\r\n                BX.create('label', {\r\n                    attrs: {\r\n                        className: this.styles['appointment-form_input-wrapper'],\r\n                    },\r\n                    children: [\r\n                        BX.create({\r\n                            tag: this.application.initParams['textBlocks'][key][\"type\"] ? 'input' : 'textarea',\r\n                            attrs: this.getTextInputAttrs(this.application.initParams['textBlocks'][key])\r\n                        })\r\n                    ]\r\n                }),\r\n            );\r\n        }\r\n\r\n        return arNodes;\r\n    }\r\n\r\n    getTextInputAttrs(attrs) {\r\n        const preparedAttrs = {}\r\n        for(const attr in attrs)\r\n        {\r\n            if (attrs.hasOwnProperty(attr))\r\n            {\r\n                if (attr === \"class\")\r\n                {\r\n                    preparedAttrs.className = this.styles[ attrs[attr] ];\r\n                }\r\n                else\r\n                {\r\n                    preparedAttrs[attr] = attrs[attr];\r\n                }\r\n            }\r\n        }\r\n        return preparedAttrs;\r\n    }\r\n\r\n    /**\r\n     * Create start button elements\r\n     * @returns {div}\r\n     */\r\n    getDefaultStartBtn() {\r\n        return BX.create('div', {\r\n            attrs: {\r\n                id: this.application.selectors.startBtnWrapId,\r\n                className: this.styles['appointment-button-wrapper']\r\n            },\r\n            children: [\r\n                BX.create('button', {\r\n                    attrs: {\r\n                        id: this.application.selectors.startBtnId,\r\n                    },\r\n                    children: [\r\n                        BX.create('span', {\r\n                            text: BX.message('ANZ_JS_START_BTN_TEXT')\r\n                        })\r\n                    ]\r\n                })\r\n            ]\r\n        });\r\n    }\r\n\r\n    getRootElement() {\r\n        return BX.create('div', {\r\n            attrs: {\r\n                id: this.application.selectors.rootNodeId\r\n            }\r\n        });\r\n    }\r\n\r\n    renderSelectionItems(listNode, dataKey, items) {\r\n        for(let key in items)\r\n        {\r\n            if(!items.hasOwnProperty(key)) continue;\r\n            if(!this.application.allowToRender(listNode, dataKey, items[key])) continue;\r\n\r\n            if(dataKey === this.application.dataKeys.scheduleKey)\r\n            {\r\n                this.renderScheduleItem(listNode, items[key]);\r\n            }\r\n            else\r\n            {\r\n                if(items[key].hasOwnProperty('price')){\r\n                    const price = Number(items[key]['price']) > 0 ? `<b>${items[key]['price']}</b>&#8381;` : \"\";\r\n                    items[key].fullName = `<p>${items[key].name}<br> <b>${price}</b></p>`;\r\n                }\r\n                const dataAttrs = {\r\n                    uid:  items[key].uid ?? key,\r\n                    name: items[key].fullName ?? items[key].name,\r\n                }\r\n                items[key].duration ? (dataAttrs.duration = items[key].duration): void(0);\r\n\r\n                BX.append(BX.create('li', {\r\n                    dataset: dataAttrs,\r\n                    html: items[key].fullName ?? items[key].name\r\n                }), listNode);\r\n            }\r\n        }\r\n\r\n        if (listNode.children.length === 0){\r\n            BX.append(\r\n                this.createEmptySelectionNode(BX.message(`ANZ_JS_${dataKey.toUpperCase()}_NOT_FOUND_ERROR`)),\r\n                listNode\r\n            );\r\n        }\r\n        else\r\n        {\r\n            if(dataKey === this.application.dataKeys.scheduleKey){\r\n                this.addHorizontalScrollButtons(listNode);\r\n            }\r\n            this.application.addItemActions(dataKey);\r\n        }\r\n    }\r\n\r\n    renderScheduleItem(scheduleList, scheduleItem) {\r\n        const serviceDuration = this.application.getServiceDuration();\r\n        const renderCustomIntervals = this.application.useServices && (serviceDuration > 0);\r\n        const timeKey = renderCustomIntervals ? \"free\" : \"freeFormatted\";\r\n\r\n        if ((typeof scheduleItem['timetable']?.[timeKey] === 'object')\r\n            && (Object.keys(scheduleItem['timetable'][timeKey]).length > 0)\r\n        ){\r\n\r\n            const days = scheduleItem['timetable'][timeKey];\r\n\r\n            for(let date in days)\r\n            {\r\n                let dayIntervals = days[date];\r\n                if(Array.isArray(dayIntervals) && (dayIntervals.length > 0))\r\n                {\r\n                    if (renderCustomIntervals)\r\n                    {\r\n                        dayIntervals = this.application.getIntervalsForServiceDuration(dayIntervals, serviceDuration*1000);\r\n                        if (dayIntervals.length <= 0) {\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    let renderColumn = this.createDayColumn(dayIntervals[0]);\r\n\r\n                    dayIntervals.forEach(interval => {\r\n                        BX.append(BX.create('span', {\r\n                            dataset: {\r\n                                displayDate: `${interval['formattedDate']} `,\r\n                                date:         interval.date,\r\n                                start:        interval.timeBegin,\r\n                                end:          interval.timeEnd,\r\n                            },\r\n                            text: `${interval['formattedTimeBegin']}`\r\n                        }), renderColumn);\r\n                    });\r\n\r\n                    scheduleList.append(renderColumn);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    createDayColumn(day){\r\n        const date = this.application.readDateInfo(day.timeBegin);\r\n\r\n        return BX.create('li', {\r\n            children: [\r\n                BX.create('p', {\r\n                    text: `${date.weekDay}\r\n                        ${day['formattedDate']}`\r\n                })\r\n            ]\r\n        });\r\n    }\r\n\r\n    addHorizontalScrollButtons(scroller){\r\n        const item = scroller.querySelector('li');\r\n\r\n        if (scroller && item){\r\n            const itemWidth = scroller.querySelector('li').clientWidth;\r\n\r\n            BX.append(BX.create('div', {\r\n                attrs: {\r\n                    className: styles[\"horizontal-scroll-buttons\"]\r\n                },\r\n                children: [\r\n                    BX.create('button', {\r\n                        attrs: {\r\n                            type: \"button\"\r\n                        },\r\n                        text: \"<\",\r\n                        events: {\r\n                            click: () => {\r\n                                if (scroller.scrollLeft !== 0) {\r\n                                    scroller.scrollBy({ left: -itemWidth*3, top: 0, behavior: 'smooth' });\r\n                                } else {\r\n                                    scroller.scrollTo({ left: scroller.scrollWidth, top: 0, behavior: 'smooth' });\r\n                                }\r\n                            }\r\n                        },\r\n                    }),\r\n                    BX.create('button', {\r\n                        attrs: {\r\n                            type: \"button\"\r\n                        },\r\n                        text: \">\",\r\n                        events: {\r\n                            click: () => {\r\n                                if (scroller.scrollLeft < (scroller.scrollWidth - itemWidth*3 - 10)) {\r\n                                    scroller.scrollBy({ left: itemWidth*3, top: 0, behavior: 'smooth' });\r\n                                } else {\r\n                                    scroller.scrollTo({ left: 0, top: 0, behavior: 'smooth' });\r\n                                }\r\n                            }\r\n                        },\r\n                    }),\r\n                ]\r\n            }), scroller);\r\n        }\r\n    }\r\n\r\n    getConfirmationBlock()\r\n    {\r\n        const confirmWarningNode = BX.create('p', {\r\n            attrs: {\r\n                className: styles['appointment-warning-text']\r\n            }\r\n        });\r\n\r\n        const placeholder = (this.application.useConfirmWith === this.application.confirmTypes.email)\r\n                               ? BX.message(\"ANZ_JS_CONFIRM_CODE_EMAIL_MESSAGE\")\r\n                               : BX.message(\"ANZ_JS_CONFIRM_CODE_SMS_MESSAGE\");\r\n        const confirmInputNode = BX.create('input', {\r\n            attrs: {\r\n                type: 'number',\r\n                className: this.styles['appointment-form_input'],\r\n                placeholder: placeholder,\r\n                required: 'true',\r\n                autocomplete: 'new-password',\r\n            },\r\n            events: {\r\n                input: (e) => {\r\n                    if (e.target?.value?.length > 4){\r\n                        e.target.value = e.target.value.substring(0, 4);\r\n                    }\r\n                }\r\n            },\r\n        });\r\n\r\n        const confirmSubmitBtn = BX.create('div', {\r\n            attrs: {\r\n                className: styles['appointment-form-button-wrapper']\r\n            },\r\n            children: [\r\n                BX.create('button', {\r\n                    attrs: {\r\n                        className: styles['appointment-form-button'],\r\n                        type: 'button'\r\n                    },\r\n                    text: BX.message(\"ANZ_JS_SEND_BTN_TEXT\"),\r\n                    events: {\r\n                        click: (e) => this.application.verifyConfirmCode(confirmInputNode.value, confirmWarningNode, e.target)\r\n                    },\r\n                }),\r\n            ]\r\n        });\r\n\r\n        const confirmRepeatBtn = BX.create('a', {\r\n            attrs: {\r\n                className: styles['appointment-form-button-link'],\r\n                href: \"#\"\r\n            }\r\n        });\r\n\r\n        const confirmWrapper = BX.create('div', {\r\n            attrs: {\r\n                id: this.application.selectors.confirmWrapperId,\r\n                style: \"width: 100%\",\r\n            },\r\n            children: [\r\n                BX.create('label', {\r\n                    attrs: {\r\n                        className: styles['appointment-form_input-wrapper'],\r\n                    },\r\n                    children: [\r\n                        confirmInputNode\r\n                    ]\r\n                }),\r\n                confirmWarningNode,\r\n                confirmSubmitBtn,\r\n                confirmRepeatBtn,\r\n            ]\r\n        });\r\n\r\n\r\n\r\n        this.application.startCodeTimerActions(confirmRepeatBtn);\r\n\r\n\r\n        return confirmWrapper;\r\n    }\r\n\r\n    createEmptySelectionNode(message: string) {\r\n        return BX.create('span', {\r\n            attrs: {\r\n                className: styles[\"empty-selection-message\"]\r\n            },\r\n            text: message\r\n        });\r\n    }\r\n}","//@flow\r\n/**\r\n * ==================================================\r\n * Developer: Alexey Nazarov\r\n * E-mail: jc1988x@gmail.com\r\n * Copyright (c) 2019 - 2022\r\n * ==================================================\r\n * \"Bit.Umc - Bitrix integration\" - params.js\r\n * 10.07.2022 23:48\r\n * ==================================================\r\n */\r\ntype ETextInputNames = | \"name\" | \"middleName\" | \"surname\" | \"phone\" | \"email\" | \"birthday\" | \"comment\";\r\ntype EIllegalAttributes = \"data-required\" | \"aria-autocomplete\";\r\n\r\ninterface ITextInputNames{\r\n    name: string,\r\n    middleName: string,\r\n    surname: string,\r\n    phone: string,\r\n    email: string,\r\n    birthday: string,\r\n    comment: string\r\n}\r\n\r\nexport const TextInputNames: ITextInputNames = {\r\n    name: \"name\",\r\n    middleName: \"middleName\",\r\n    surname: \"surname\",\r\n    phone: \"phone\",\r\n    email: \"email\",\r\n    birthday: \"birthday\",\r\n    comment: \"comment\"\r\n};\r\n\r\nexport interface ITextObject {\r\n    type?: string,\r\n    placeholder: string,\r\n    id: string,\r\n    maxlength: string,\r\n    class: string,\r\n    name: ETextInputNames,\r\n    [key: EIllegalAttributes]: string,\r\n    autocomplete?: string,\r\n}","// @disabled-flow\r\n/**\r\n * ==================================================\r\n * Developer: Alexey Nazarov\r\n * E-mail: jc1988x@gmail.com\r\n * Copyright (c) 2019 - 2022\r\n * ==================================================\r\n * \"Bit.Umc - Bitrix integration\" - app.js\r\n * 10.07.2022 22:37\r\n * ==================================================\r\n */\r\n'use strict';\r\nimport '../../styles/app.css';\r\nimport styles from \"../../styles/app.css\";\r\nimport {convertHexToHsl, maskInput} from \"../utils/functions\";\r\nimport \"date\";\r\nimport {Event} from 'main.core';\r\nimport {EventManager} from \"../utils/eventManager\";\r\nimport {MessageBox, MessageBoxButtons} from 'ui.dialogs.messagebox';\r\nimport {Renderer} from \"../utils/renderer\";\r\nimport type {ITextObject} from \"../../types/params\";\r\nimport {TextInputNames} from \"../../types/params\";\r\n\r\nexport class AppointmentSteps\r\n{\r\n    selectionStep: string         = '';\r\n    currentFormStep: HTMLElement  = null;\r\n    formStepNodes: any            = {one: null, two: null, userData: null}\r\n    phoneMask: string             = '+7(000)000-00-00';\r\n    loaded: boolean               = false;\r\n    timeExpires: number           = 0;\r\n    requiredInputs: HTMLElement[] = [];\r\n    initParams: any               = {};\r\n    eventHandlersAdded            = {};\r\n    servicesStorage               = {};\r\n    dataKeys = {\r\n        clinicsKey:     \"clinics\",\r\n        specialtiesKey: \"specialties\",\r\n        employeesKey:   \"employees\",\r\n        servicesKey:    \"services\",\r\n        scheduleKey:    \"schedule\",\r\n    };\r\n    data = {\r\n        [this.dataKeys.clinicsKey]:     [],\r\n        [this.dataKeys.specialtiesKey]: {},\r\n        [this.dataKeys.servicesKey]:    {},\r\n        [this.dataKeys.employeesKey]:   {},\r\n        [this.dataKeys.scheduleKey]:    {}\r\n    };\r\n    orderData       = {};\r\n    selectionBlocks = {};\r\n    selectionNodes  = {};\r\n    textNodes       = {};\r\n    defaultText     = {};\r\n\r\n    selectDoctorBeforeService = true;\r\n\r\n    /**\r\n     * AppointmentSteps constructor\r\n     * @param params\r\n     */\r\n    constructor(params)\r\n    {\r\n        this.firstInit      = true;\r\n        this.initParams     = params;\r\n        this.selectors      = this.getAppSelectors(styles);\r\n        this.selectionSteps = Object.values(this.dataKeys);\r\n\r\n        this.useServices \t\t\t\t\t= (params.useServices === \"Y\");\r\n        this.useTimeSteps \t\t\t\t\t= (params.useTimeSteps === \"Y\");\r\n        this.timeStepDurationMinutes\t\t= Number(params.timeStepDurationMinutes);\r\n        this.strictCheckingOfRelations\t\t= (params.strictCheckingOfRelations === \"Y\");\r\n        this.showDoctorsWithoutDepartment\t= (params.showDoctorsWithoutDepartment === \"Y\");\r\n        this.confirmTypes                   = params.confirmTypes;\r\n        this.useConfirmWith                 = (params.useConfirmWith);\r\n        this.useEmailNote                   = (params.useEmailNote === \"Y\");\r\n\r\n        this.companyLogo      = params.companyLogo ?? false;\r\n        this.useCustomMainBtn = (params.useCustomMainBtn === \"Y\") && params['customMainBtnId'];\r\n        this.customColors     = params.customColors ?? {};\r\n\r\n        this.filledInputs = {\r\n            [this.dataKeys.clinicsKey]: {\r\n                clinicUid: false,\r\n                clinicName: false,\r\n            },\r\n            [this.dataKeys.specialtiesKey]: {\r\n                specialty: false,\r\n                specialtyUid: false,\r\n            },\r\n            [this.dataKeys.servicesKey]: {\r\n                serviceUid: false,\r\n                serviceName: false,\r\n                serviceDuration: false,\r\n            },\r\n            [this.dataKeys.employeesKey]: {\r\n                refUid: false,\r\n                doctorName: false,\r\n            },\r\n            [this.dataKeys.scheduleKey]: {\r\n                orderDate: false,\r\n                timeBegin: false,\r\n                timeEnd: false,\r\n            },\r\n            textValues: {\r\n                name: \t\tthis.filledInputs?.textValues?.name       ?? false,\r\n                surname: \tthis.filledInputs?.textValues?.surname    ?? false,\r\n                middleName: this.filledInputs?.textValues?.middleName ?? false,\r\n                phone: \t\tthis.filledInputs?.textValues?.phone      ?? false,\r\n                address: \tthis.filledInputs?.textValues?.address    ?? false,\r\n                email: \t    this.filledInputs?.textValues?.email      ?? false,\r\n                birthday:   this.filledInputs?.textValues?.birthday   ?? false,\r\n                comment: \tthis.filledInputs?.textValues?.comment    ?? false,\r\n            },\r\n        }\r\n\r\n        this.prepareSelectionBlocksForRender();\r\n        this.renderer = new Renderer(styles, this);\r\n    }\r\n\r\n    /**\r\n     * create js objects that contains html ids and default textContent for selection blocks\r\n     * this objects will be used for creating selection blocks html\r\n     */\r\n    prepareSelectionBlocksForRender(){\r\n        this.selectionSteps.forEach(step => {\r\n            this.selectionBlocks[step] = {\r\n                \"blockId\":      `appointment_${step}_block`,\r\n                \"listId\":       `appointment_${step}_list`,\r\n                \"selectedId\":   `appointment_${step}_selected`,\r\n                \"inputId\":      `appointment_${step}_value`,\r\n                \"isRequired\":   !(step === this.dataKeys.servicesKey && this.initParams.useServices !== \"Y\")\r\n            }\r\n            this.defaultText[step] = BX.message(`ANZ_JS_APPOINTMENT_SELECT_${step.toUpperCase()}_TEXT`);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * start application\r\n     */\r\n    run() {\r\n        this.checkRoot();\r\n        this.insertAppHtml();\r\n        this.init();\r\n    }\r\n\r\n    /**\r\n     * check root selector and creates it if needed\r\n     */\r\n    checkRoot(){\r\n        if (!this.root || !BX.type.isDomNode(this.root))\r\n        {\r\n            this.root = this.renderer.getRootElement();\r\n            BX.append(this.root, document.body);\r\n        }\r\n        else\r\n        {\r\n            BX.cleanNode(this.root);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * build basic html skeleton and insert it to DOM\r\n     */\r\n    insertAppHtml(){\r\n        BX.append(\r\n            this.renderer.getAppHtmlSkeleton(),\r\n            this.root\r\n        );\r\n\r\n        !this.useCustomMainBtn && BX.append(this.renderer.getDefaultStartBtn(), this.root);\r\n    }\r\n\r\n    /**\r\n     * start all application actions\r\n     */\r\n    init(){\r\n        try {\r\n            this.initCustomEvents();\r\n            this.initFormStepNodes();\r\n            this.initStartBtn();\r\n            this.initBaseNodes();\r\n            this.initOverlayAction();\r\n            this.initForm();\r\n            this.initMobileCloseBtn();\r\n            this.initSelectionNodes();\r\n            this.initTextNodes();\r\n            this.addPhoneMasks();\r\n            this.addCalendarSelection();\r\n            this.addCustomColors();\r\n        }\r\n        catch (e) {\r\n            this.logResultErrors(e);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * subscribing on custom js events\r\n     */\r\n    initCustomEvents()\r\n    {\r\n        EventManager.subscribe(EventManager.clinicsLoaded, () => {\r\n            this.loaded = true;\r\n            try\r\n            {\r\n                this.renderBlock(this.dataKeys.clinicsKey);\r\n            }\r\n            catch(e)\r\n            {\r\n                this.logResultErrors(e);\r\n            }\r\n        });\r\n\r\n        EventManager.subscribe(EventManager.clinicsRendered, () => {\r\n            this.createSpecialtiesList();\r\n            this.toggleLoader(false);\r\n        });\r\n\r\n        EventManager.subscribe(EventManager.formStepChanged, (e) => {\r\n            e.data.isBack ? (this.selectionStep = this.dataKeys.specialtiesKey) : void(0);\r\n            this.changeFormStepActions(e.data);\r\n            this.activateSelectionNodes();\r\n        });\r\n    }\r\n\r\n    initFormStepNodes(){\r\n        this.currentFormStep = this.formStepNodes.one   = BX(this.selectors.formStepIds.one);\r\n        this.formStepNodes.two   = BX(this.selectors.formStepIds.two);\r\n        this.formStepNodes.userData = BX(this.selectors.formStepIds.userData);\r\n    }\r\n\r\n    /**\r\n     * find or create start button and add event handler for click\r\n     */\r\n    initStartBtn() {\r\n        if(!this.firstInit && this.useCustomMainBtn){\r\n            return;\r\n        }\r\n        const startBtnId = this.useCustomMainBtn ? this.initParams['customMainBtnId'] : this.selectors.startBtnId;\r\n        this.startBtn = BX(startBtnId);\r\n        if (BX.type.isDomNode(this.startBtn))\r\n        {\r\n            EventManager.bind(this.startBtn, 'click', this.togglePopup.bind(this));\r\n        }\r\n        else\r\n        {\r\n            throw new Error(`${BX.message('ANZ_JS_NODE_NOT_FOUND')} \"${this.initParams['customMainBtnId']}\"`)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * find all base nodes and save them to this object props\r\n     */\r\n    initBaseNodes() {\r\n        this.overlay        = BX(this.selectors.overlayId);\r\n        this.startBtnWrap   = BX(this.selectors.startBtnWrapId);\r\n        this.mobileCloseBtn = BX(this.selectors.mobileCloseBtnId);\r\n        this.messageNode    = BX(this.selectors.messageNodeId);\r\n        this.submitBtn      = BX(this.selectors.submitBtnId);\r\n        this.resultBlock    = BX(this.selectors.appResultBlockId);\r\n    }\r\n\r\n    /**\r\n     * make popup hidden by click to overlay\r\n     */\r\n    initOverlayAction() {\r\n        if (BX.type.isDomNode(this.overlay))\r\n        {\r\n            EventManager.bind(this.overlay, 'click', (e) => {\r\n                if (e.target?.getAttribute('id') === this.selectors.overlayId){\r\n                    this.togglePopup();\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * find form node and add event listeners\r\n     */\r\n    initForm() {\r\n        this.form = BX(this.selectors.formId);\r\n        if (this.form)\r\n        {\r\n            EventManager.bind(this.form, 'submit', this.submit.bind(this));\r\n        }\r\n        else\r\n        {\r\n            throw new Error(`${BX.message('ANZ_JS_NODE_NOT_FOUND')} ${this.selectors.formId}`)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * find node and add event listener to close form\r\n     */\r\n    initMobileCloseBtn() {\r\n        if (this.mobileCloseBtn)\r\n        {\r\n            EventManager.bind(this.mobileCloseBtn, 'click', this.togglePopup.bind(this))\r\n        }\r\n        else\r\n        {\r\n            throw new Error(`${BX.message('ANZ_JS_NODE_NOT_FOUND')} ${this.selectors.mobileCloseBtnId}`)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * find nodes and save their data to this object\r\n     */\r\n    initSelectionNodes() {\r\n        for (const key in this.selectionBlocks)\r\n        {\r\n            this.selectionNodes[key] = {\r\n                blockNode: \t\tBX(this.selectionBlocks[key].blockId),\r\n                listNode: \t\tBX(this.selectionBlocks[key].listId),\r\n                selectedNode: \tBX(this.selectionBlocks[key].selectedId),\r\n                inputNode: \t\tBX(this.selectionBlocks[key].inputId),\r\n            }\r\n\r\n            if (this.selectionBlocks[key].isRequired)\r\n            {\r\n                this.requiredInputs.push(this.selectionNodes[key].inputNode);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * find nodes, add actions and save their data to this object\r\n     */\r\n    initTextNodes() {\r\n        this.initParams['textBlocks'].forEach((block: ITextObject) => {\r\n            const input = BX(block.id);\r\n            if (!input){\r\n                throw new Error(`${BX.message(\"ANZ_JS_NODE_NOT_FOUND\")} ${block.id}`);\r\n            }\r\n\r\n            const currentValue = this.filledInputs.textValues[block.name];\r\n            input.value = currentValue ? currentValue : '';\r\n            if (input && currentValue && (block.name === TextInputNames.birthday)){\r\n                const date = new Date(currentValue);\r\n                input.value = this.convertDateToDisplay(date.getTime(), false, true);\r\n            }\r\n\r\n            EventManager.bind(input, 'input', (e)=> {\r\n                let val: string = e.target.value ?? '';\r\n                if (e.target.name === TextInputNames.phone && val.length > this.phoneMask.length){\r\n                    val = val.substring(0, this.phoneMask.length)\r\n                }\r\n                this.filledInputs.textValues[block.name] = val;\r\n            })\r\n\r\n            if (block[\"data-required\"] === \"true\")\r\n            {\r\n                this.requiredInputs.push(input);\r\n            }\r\n            else\r\n            {\r\n                if ((this.useConfirmWith === this.confirmTypes.email) && (block.name === TextInputNames.email))\r\n                {\r\n                    this.requiredInputs.push(input);\r\n                }\r\n            }\r\n\r\n            this.textNodes[block.name] = {\r\n                inputNode: input,\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * loading data from 1c and build selectors html\r\n     */\r\n    start() {\r\n        this.toggleLoader(true);\r\n        this.getListClinic();\r\n    }\r\n\r\n    getListClinic(){\r\n        BX.ajax.runAction('anz:appointment.oneCController.getClinics', {\r\n            data: {\r\n                sessid: BX.bitrix_sessid()\r\n            }\r\n        })\r\n        .then(clinicsResponse => {\r\n            if (clinicsResponse.data?.error) {\r\n                throw new Error(clinicsResponse.data?.error);\r\n            }\r\n            else if(clinicsResponse.data?.length === 0) {\r\n                throw new Error(BX.message(\"ANZ_JS_CLINICS_NOT_FOUND_ERROR\"));\r\n            }\r\n            else {\r\n                this.data.clinics = clinicsResponse.data;\r\n                EventManager.emit(EventManager.clinicsLoaded);\r\n            }\r\n        })\r\n        .catch(e => {\r\n            this.processLoadDataError(e);\r\n        });\r\n    }\r\n\r\n    getListEmployees()\r\n    {\r\n        this.toggleLoader(true);\r\n        BX.ajax.runAction('anz:appointment.oneCController.getEmployees', {\r\n            data: {\r\n                sessid: BX.bitrix_sessid()\r\n            }\r\n        })\r\n        .then(employeesResponse => {\r\n            if (employeesResponse.data?.error) {\r\n                throw new Error(employeesResponse.data?.error);\r\n            }\r\n            else if(Object.keys(employeesResponse.data).length === 0) {\r\n                throw new Error(BX.message(\"ANZ_JS_DOCTORS_NOT_FOUND_ERROR\"));\r\n            }\r\n            else {\r\n                this.data.employees = employeesResponse.data;\r\n                EventManager.emit(EventManager.employeesLoaded);\r\n            }\r\n            this.toggleLoader(false);\r\n        })\r\n        .catch(e => {\r\n            this.processLoadDataError(e);\r\n        });\r\n    }\r\n\r\n    getSchedule(clinicUid, employeeUid){\r\n        this.toggleLoader(true)\r\n        BX.ajax.runAction('anz:appointment.oneCController.getSchedule', {\r\n            data: {\r\n                sessid: BX.bitrix_sessid(),\r\n                clinicGuid: clinicUid,\r\n                employeeGuid: employeeUid,\r\n            }\r\n        })\r\n        .then(scheduleResponse => {\r\n            if (scheduleResponse.data?.error) {\r\n                throw new Error(scheduleResponse.data?.error);\r\n            }\r\n\r\n            if ((typeof scheduleResponse.data === 'object'))\r\n            {\r\n                this.data.schedule = scheduleResponse.data;\r\n                this.messageNode.textContent = \"\";\r\n            }\r\n            EventManager.emit(EventManager.scheduleLoaded);\r\n            this.toggleLoader(false);\r\n        })\r\n        .catch(e => {\r\n            this.processLoadDataError(e);\r\n        });\r\n    }\r\n\r\n    getListNomenclature(clinicGuid){\r\n        this.toggleLoader(true);\r\n        BX.ajax.runAction('anz:appointment.oneCController.getNomenclature', {\r\n            data: {\r\n                sessid: BX.bitrix_sessid(),\r\n                clinicGuid: clinicGuid,\r\n            }\r\n        })\r\n        .then((nomenclature) => {\r\n            if (nomenclature.data?.error)\r\n            {\r\n                throw new Error(nomenclature.data.error);\r\n            }\r\n            else\r\n            {\r\n                if (Object.keys(nomenclature.data).length > 0)\r\n                {\r\n                    this.data.services = nomenclature.data;\r\n                    this.bindServicesToSpecialties();\r\n                    this.servicesStorage[clinicUid] = {...this.data.services}\r\n                }\r\n                this.renderSpecialtiesList();//todo move to renderBlocks?\r\n            }\r\n            this.toggleLoader(false);\r\n        })\r\n        .catch(e => {\r\n            this.processLoadDataError(e);\r\n        });\r\n    }\r\n\r\n    renderSpecialtiesList(){\r\n        this.renderBlock(this.dataKeys.specialtiesKey);\r\n    }\r\n\r\n    renderServicesList(){\r\n        this.renderBlock(this.dataKeys.servicesKey);\r\n    }\r\n\r\n    renderEmployeesList() {\r\n        this.renderBlock(this.dataKeys.employeesKey);\r\n    }\r\n\r\n    renderScheduleList() {\r\n        this.renderBlock(this.dataKeys.scheduleKey);\r\n    }\r\n\r\n    renderBlock(dataKey)\r\n    {\r\n        const listNode = this.selectionNodes[dataKey]?.listNode;\r\n        if(!listNode){\r\n            throw new Error(BX.message(`ANZ_JS_${dataKey.toUpperCase()}_NODE_NOT_FOUND_ERROR`));\r\n        }\r\n        BX.cleanNode(listNode);\r\n\r\n        let items = this.data[dataKey];\r\n        if(dataKey === this.dataKeys.scheduleKey)\r\n        {\r\n            listNode.classList.add(styles[\"column-mode\"]);\r\n\r\n            const selectedClinic        = this.filledInputs[this.dataKeys.clinicsKey].clinicUid;\r\n            const selectedSpecialtyUid  = this.filledInputs[this.dataKeys.specialtiesKey].specialtyUid;\r\n            const selectedEmployeeUid   = this.filledInputs[this.dataKeys.employeesKey].refUid;\r\n            if(items.hasOwnProperty(selectedClinic)\r\n                && items[selectedClinic]?.hasOwnProperty(selectedSpecialtyUid)\r\n                && items[selectedClinic][selectedSpecialtyUid]?.hasOwnProperty(selectedEmployeeUid)\r\n                && (typeof items[selectedClinic][selectedSpecialtyUid][selectedEmployeeUid] === 'object')\r\n            ){\r\n                items = [items[selectedClinic][selectedSpecialtyUid][selectedEmployeeUid]];\r\n            }\r\n        }\r\n\r\n        this.renderer.renderSelectionItems(listNode, dataKey, items);\r\n        (dataKey === this.dataKeys.clinicsKey) ? EventManager.emit(EventManager.clinicsRendered) : void(0);\r\n    }\r\n\r\n    allowToRender(listNode: HTMLElement, dataKey: string, item: any): boolean\r\n    {\r\n        let canRender = true;\r\n        const selectedClinic        = this.filledInputs[this.dataKeys.clinicsKey].clinicUid;\r\n        const selectedSpecialtyUid  = this.filledInputs[this.dataKeys.specialtiesKey].specialtyUid;\r\n        const selectedEmployeeUid   = this.filledInputs[this.dataKeys.employeesKey].refUid;\r\n        const selectedServiceUid    = this.filledInputs[this.dataKeys.servicesKey].serviceUid;\r\n        let clinicCondition, specialtyCondition;\r\n\r\n        switch (dataKey)\r\n        {\r\n            case this.dataKeys.specialtiesKey:\r\n                const alreadyRendered = listNode.querySelector(`[data-uid=\"${item.uid}\"]`);\r\n                clinicCondition = item.clinics.includes(selectedClinic);\r\n                if(this.strictCheckingOfRelations){\r\n                    canRender = clinicCondition;\r\n                    if (this.showDoctorsWithoutDepartment){\r\n                        canRender = (clinicCondition || item.clinics.includes(''));\r\n                    }\r\n                }\r\n                canRender = canRender && BX.type.isNotEmptyString(item.name) && !alreadyRendered;\r\n                break;\r\n\r\n            case this.dataKeys.employeesKey:\r\n                specialtyCondition = (item.specialtyUid === selectedSpecialtyUid);\r\n                clinicCondition    = (selectedClinic === item.clinicUid);\r\n\r\n                canRender = specialtyCondition;\r\n\r\n                if(this.strictCheckingOfRelations){\r\n                    if (this.showDoctorsWithoutDepartment){\r\n                        canRender = (specialtyCondition && !item.clinicUid)\r\n                            ||\r\n                            (specialtyCondition && clinicCondition);\r\n                    }\r\n                    else\r\n                    {\r\n                        canRender = specialtyCondition && clinicCondition;\r\n                    }\r\n                }\r\n                if (this.useServices && !this.selectDoctorBeforeService)\r\n                {\r\n                    canRender = canRender && item.services.hasOwnProperty(selectedServiceUid);\r\n                }\r\n                break;\r\n\r\n            case this.dataKeys.servicesKey:\r\n                canRender = (selectedSpecialtyUid === item.specialtyUid);\r\n                if (this.selectDoctorBeforeService)\r\n                {\r\n                    canRender = canRender && this.data.employees[selectedEmployeeUid].services.hasOwnProperty(item.uid);\r\n                }\r\n                break;\r\n\r\n            case this.dataKeys.scheduleKey:\r\n                //canRender always true new schedule structure used\r\n                canRender = true;\r\n\r\n                //old condition\r\n                //canRender = (item.clinicUid === selectedClinic) && (item.refUid === selectedEmployeeUid)\r\n                break;\r\n            default:\r\n                break;\r\n\r\n        }\r\n        return canRender;\r\n    }\r\n\r\n    getServiceDuration(): number\r\n    {\r\n        const selectedEmployee = this.filledInputs[this.dataKeys.employeesKey];\r\n        const selectedEmployeeFullData = this.data[this.dataKeys.employeesKey]?.[selectedEmployee.refUid];\r\n\r\n        const selectedService = this.filledInputs[this.dataKeys.servicesKey];\r\n        let serviceUid = selectedService.serviceUid;\r\n        let serviceDuration = Number(selectedService.serviceDuration);\r\n\r\n        if(selectedEmployeeFullData?.services?.hasOwnProperty(serviceUid))\r\n        {\r\n            if (selectedEmployeeFullData.services[serviceUid]?.hasOwnProperty('personalDuration'))\r\n            {\r\n                const personalDuration = selectedEmployeeFullData.services[serviceUid]['personalDuration'];\r\n                serviceDuration = Number(personalDuration) > 0 ? Number(personalDuration) : serviceDuration;\r\n            }\r\n        }\r\n        return serviceDuration;\r\n    }\r\n\r\n    getIntervalsForServiceDuration(intervals, serviceDurationMs) {\r\n        const newIntervals = [];\r\n        intervals.length && intervals.forEach((day) => {\r\n            const timestampTimeBegin = (new Date(day.timeBegin)).getTime();\r\n            const timestampTimeEnd = (new Date(day.timeEnd)).getTime();\r\n            const timeDifference = timestampTimeEnd - timestampTimeBegin;\r\n            const appointmentsCount = Math.floor(timeDifference / serviceDurationMs);\r\n            if (appointmentsCount > 0)\r\n            {\r\n                if (this.useTimeSteps && (serviceDurationMs >= 30*60*1000)) //use timeSteps only for services with duration>=30 minutes\r\n                {\r\n                    let start   = new Date(timestampTimeBegin);\r\n                    let end     = new Date(timestampTimeBegin + serviceDurationMs);\r\n                    while(end.getTime() <= timestampTimeEnd){\r\n                        newIntervals.push({\r\n                            \"date\": \t\t\t\tday.date,\r\n                            \"timeBegin\": \t\t\tthis.convertDateToISO(Number(start)),\r\n                            \"timeEnd\": \t\t\t\tthis.convertDateToISO(Number(end)),\r\n                            \"formattedDate\": \t\tthis.convertDateToDisplay(Number(start), false),\r\n                            \"formattedTimeBegin\": \tthis.convertDateToDisplay(Number(start), true),\r\n                            \"formattedTimeEnd\": \tthis.convertDateToDisplay(Number(end), true),\r\n                        });\r\n                        start.setMinutes(start.getMinutes() + this.timeStepDurationMinutes);\r\n                        end.setMinutes(end.getMinutes() + this.timeStepDurationMinutes);\r\n                    }\r\n                }\r\n                else\r\n                {\r\n                    for (let i = 0; i < appointmentsCount; i++)\r\n                    {\r\n                        let start = Number(new Date(timestampTimeBegin + (serviceDurationMs * i)));\r\n                        let end = Number(new Date(timestampTimeBegin + (serviceDurationMs * (i+1))));\r\n                        newIntervals.push({\r\n                            \"date\": \t\t\t\tday.date,\r\n                            \"timeBegin\": \t\t\tthis.convertDateToISO(start),\r\n                            \"timeEnd\": \t\t\t\tthis.convertDateToISO(end),\r\n                            \"formattedDate\": \t\tthis.convertDateToDisplay(start, false),\r\n                            \"formattedTimeBegin\": \tthis.convertDateToDisplay(start, true),\r\n                            \"formattedTimeEnd\": \tthis.convertDateToDisplay(end, true),\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        return newIntervals;\r\n    }\r\n\r\n    toggleSelectionList(dataKey: string, selected: HTMLElement, list: HTMLElement) {\r\n        list.classList.toggle(styles['active']);\r\n        for (const nodesKey in this.selectionNodes) {\r\n            if (\r\n                this.selectionNodes.hasOwnProperty(nodesKey)\r\n                && nodesKey !== dataKey\r\n            ){\r\n                this.selectionNodes[nodesKey]?.listNode?.classList.remove(styles['active']);\r\n            }\r\n        }\r\n    }\r\n\r\n    addItemActions(dataKey){\r\n        const items = this.selectionNodes[dataKey].listNode.children;\r\n        if (!items.length){\r\n            return;\r\n        }\r\n        for (let item of items) {\r\n            if (dataKey === this.dataKeys.scheduleKey)\r\n            {\r\n                const times = item.querySelectorAll('span');\r\n                times.length && times.forEach((time) => {\r\n                    time.addEventListener('click', (e)=>{\r\n                        e.stopPropagation();\r\n                        this.selectionNodes[dataKey].listNode.classList.remove(styles['active']);\r\n                        this.selectionNodes[dataKey].selectedNode.innerHTML = `\r\n                            <span>\r\n                                ${e.currentTarget.dataset.displayDate} - \r\n                                ${e.currentTarget.textContent}\r\n                            </span>\r\n                        `;\r\n\r\n                        this.changeSelectionStep(dataKey, e.currentTarget);\r\n                        this.activateSelectionNodes();\r\n                    })\r\n                });\r\n            }\r\n            else\r\n            {\r\n                item.addEventListener('click', (e)=>{\r\n                    e.stopPropagation();\r\n                    this.selectionNodes[dataKey].listNode.classList.remove(styles['active']);\r\n                    this.selectionNodes[dataKey].selectedNode.innerHTML = `<span>${e.currentTarget.textContent}</span>`;\r\n                    this.changeSelectionStep(dataKey, e.currentTarget);\r\n                    if(dataKey !== this.dataKeys.specialtiesKey)\r\n                    {\r\n                        this.activateSelectionNodes();\r\n                    }\r\n                    else\r\n                    {\r\n                        this.activateStepButtons();\r\n                    }\r\n                })\r\n            }\r\n        }\r\n    }\r\n\r\n    changeSelectionStep(dataKey, target){\r\n        this.selectionNodes[dataKey].inputNode.value = target.dataset.uid;\r\n        switch (dataKey)\r\n        {\r\n            case this.dataKeys.clinicsKey:\r\n                this.filledInputs[dataKey].clinicUid = target.dataset.uid;\r\n                this.filledInputs[dataKey].clinicName = target.dataset.name;\r\n\r\n                this.getListEmployees();\r\n\r\n                this.renderSpecialtiesList();\r\n\r\n                break;\r\n            case this.dataKeys.specialtiesKey:\r\n                this.filledInputs[dataKey].specialty = target.dataset.name;\r\n                this.filledInputs[dataKey].specialtyUid = target.dataset.uid;\r\n\r\n                if (this.useServices)\r\n                {\r\n                    const clinicUid = this.filledInputs[dataKey].clinicUid;\r\n                    if(this.servicesStorage[clinicUid])\r\n                    {\r\n                        this.data.services = {...this.servicesStorage[clinicUid]};\r\n                    }\r\n                    else\r\n                    {\r\n                        this.toggleLoader(true);\r\n                        this.getListNomenclature(`${clinicUid}`);\r\n                    }\r\n                }\r\n\r\n\r\n                break;\r\n            case this.dataKeys.servicesKey:\r\n                this.filledInputs[dataKey].serviceName = target.textContent;\r\n                this.filledInputs[dataKey].serviceUid = target.dataset.uid;\r\n                this.filledInputs[dataKey].serviceDuration = target.dataset.duration;\r\n                this.selectDoctorBeforeService ? this.renderScheduleList(): this.renderEmployeesList();\r\n                break;\r\n            case this.dataKeys.employeesKey:\r\n                this.filledInputs[dataKey].doctorName = target.textContent;\r\n                this.filledInputs[dataKey].refUid = target.dataset.uid;\r\n                this.getSchedule(this.filledInputs[dataKey].clinicUid, this.filledInputs[dataKey].refUid);\r\n                if(this.useServices){\r\n                    if (this.selectDoctorBeforeService){\r\n                        this.renderServicesList();\r\n                    }else{\r\n                        this.renderScheduleList();\r\n                    }\r\n                }else{\r\n                    this.renderScheduleList();\r\n                }\r\n                break;\r\n            case this.dataKeys.scheduleKey:\r\n                this.filledInputs[dataKey].orderDate = target.dataset.date;\r\n                this.filledInputs[dataKey].timeBegin = target.dataset.start;\r\n                this.filledInputs[dataKey].timeEnd = target.dataset.end;\r\n                this.selectionNodes[dataKey].inputNode.value = target.dataset.date;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        this.selectionStep = dataKey;\r\n    }\r\n\r\n    bindServicesToSpecialties() {\r\n        const services  = this.data.services;\r\n        const employees = this.data.employees;\r\n        if(Object.keys(employees).length > 0)\r\n        {\r\n            for (const employeeUid in employees)\r\n            {\r\n                if (!employees.hasOwnProperty(employeeUid)) { return; }\r\n\r\n                const empServices = employees[employeeUid].services;\r\n                const specialty   = employees[employeeUid]['specialtyName'];\r\n\r\n                if(specialty){\r\n                    if(empServices && Object.keys(empServices).length > 0) {\r\n                        for (const empServiceUid in empServices)\r\n                        {\r\n                            if (!empServices.hasOwnProperty(empServiceUid)) { return; }\r\n\r\n                            if (services.hasOwnProperty(empServiceUid)){\r\n                                services[empServiceUid].specialtyUid = employees[employeeUid].specialtyUid;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    createSpecialtiesList(){\r\n        const employees = this.data.employees;\r\n        if(Object.keys(employees).length > 0)\r\n        {\r\n            for (const uid in employees)\r\n            {\r\n                const specialty = employees[uid]['specialtyName'];\r\n                specialty && this.addSpecialty(employees[uid]);\r\n            }\r\n        }\r\n    }\r\n\r\n    addSpecialty(employee)\r\n    {\r\n        if (employee.specialtyUid)\r\n        {\r\n            if(this.data[this.dataKeys.specialtiesKey][employee.specialtyUid])\r\n            {\r\n                this.addClinicToSpecialty(this.data[this.dataKeys.specialtiesKey][employee.specialtyUid], employee.clinicUid);\r\n            }\r\n            else\r\n            {\r\n                this.data[this.dataKeys.specialtiesKey][employee.specialtyUid] = {\r\n                    uid:        employee.specialtyUid,\r\n                    name:       employee['specialtyName'],\r\n                    clinics:    [employee.clinicUid]\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    addClinicToSpecialty(specialty, clinicUid){\r\n        if(Array.isArray(specialty.clinics) && !specialty.clinics.includes(clinicUid))\r\n        {\r\n            specialty.clinics.push(clinicUid);\r\n        }\r\n    }\r\n\r\n    activateSelectionNodes(){\r\n        let current = false;\r\n        let next = false;\r\n        this.selectionSteps.forEach(nodesKey => {\r\n            if (!this.useServices && nodesKey === this.dataKeys.servicesKey){\r\n                return;\r\n            }\r\n\r\n            if (this.selectionNodes.hasOwnProperty(nodesKey))\r\n            {\r\n                const block = this.selectionNodes[nodesKey].blockNode;\r\n                if (!current && !next){\r\n                    block.classList.remove(styles[\"disabled\"]);\r\n                }\r\n                else if (current && !next){\r\n                    block.classList.remove(styles[\"disabled\"])\r\n                    this.resetValue(nodesKey);\r\n                }\r\n                else{\r\n                    block.classList.add(styles[\"disabled\"]);\r\n                    this.resetValue(nodesKey);\r\n                }\r\n                next = current;\r\n\r\n                if(nodesKey === this.selectionStep)\r\n                {\r\n                    current = true;\r\n\r\n                    const selectedSpecialty = this.filledInputs[this.dataKeys.specialtiesKey].specialtyUid;\r\n                    const selectedDate      = this.filledInputs[this.dataKeys.scheduleKey].orderDate;\r\n\r\n                    const specialtyCondition = (nodesKey === this.dataKeys.specialtiesKey) && selectedSpecialty;\r\n                    const dateCondition      = (nodesKey === this.dataKeys.scheduleKey) && selectedDate;\r\n                    if( ((this.currentFormStep === this.formStepNodes.one) && specialtyCondition)\r\n                        || ((this.currentFormStep === this.formStepNodes.two) && dateCondition)\r\n                    ){\r\n                        this.activateStepButtons();\r\n                    }\r\n                    else{\r\n                        this.deactivateStepButtons();\r\n                    }\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    resetValue(nodesKey: string) {\r\n        this.selectionNodes[nodesKey].selectedNode.textContent = this.defaultText[nodesKey];\r\n        this.selectionNodes[nodesKey].inputNode.value = \"\";\r\n        if (this.filledInputs.hasOwnProperty(nodesKey)){\r\n            for (const propKey in this.filledInputs[nodesKey]) {\r\n                if (this.filledInputs[nodesKey].hasOwnProperty(propKey)){\r\n                    this.filledInputs[nodesKey][propKey] = false;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    setSelectionDoctorBeforeService(value: boolean){\r\n        if(this.filledInputs[this.dataKeys.specialtiesKey].specialty !== false)\r\n        {\r\n            this.resetValue(this.dataKeys.employeesKey);\r\n\r\n            this.selectDoctorBeforeService = value;\r\n            if(this.useServices)\r\n            {\r\n                this.resetValue(this.dataKeys.servicesKey);\r\n\r\n                if (value === true){\r\n                    BX.insertBefore(\r\n                        this.selectionNodes[this.dataKeys.employeesKey].blockNode,\r\n                        this.selectionNodes[this.dataKeys.servicesKey].blockNode\r\n                    );\r\n                    this.selectionSteps[3] = this.dataKeys.servicesKey;\r\n                    this.selectionSteps[2] = this.dataKeys.employeesKey;\r\n                    this.renderEmployeesList();\r\n                }else{\r\n                    BX.insertBefore(\r\n                        this.selectionNodes[this.dataKeys.servicesKey].blockNode,\r\n                        this.selectionNodes[this.dataKeys.employeesKey].blockNode\r\n                    );\r\n                    this.selectionSteps[2] = this.dataKeys.servicesKey;\r\n                    this.selectionSteps[3] = this.dataKeys.employeesKey;\r\n                    this.renderServicesList();\r\n                }\r\n            }\r\n            else{\r\n                this.renderEmployeesList();\r\n            }\r\n            EventManager.emit(EventManager.formStepChanged, new Event.BaseEvent({\r\n                data: {\r\n                    previousStep: this.formStepNodes.one,\r\n                    newStep: this.formStepNodes.two,\r\n                },\r\n            }));\r\n        }\r\n        else\r\n        {\r\n            this.checkRequiredFields();\r\n        }\r\n    }\r\n\r\n    changeFormStep(nextStep: HTMLElement, isBack: boolean = false) {\r\n        EventManager.emit(EventManager.formStepChanged, new Event.BaseEvent({\r\n            data: {\r\n                previousStep: this.currentFormStep,\r\n                newStep: nextStep,\r\n                isBack: isBack\r\n            },\r\n        }));\r\n    }\r\n\r\n    changeFormStepActions(data)\r\n    {\r\n        if(BX.type.isDomNode(data?.newStep)){\r\n            this.currentFormStep = data.newStep;\r\n            data.newStep.classList.remove(styles['hidden']);\r\n        }\r\n        if(BX.type.isDomNode(data?.previousStep)){\r\n            data.previousStep.classList.add(styles['hidden']);\r\n        }\r\n\r\n        if (this.currentFormStep === this.formStepNodes.userData)\r\n        {\r\n            this.form.classList.add(styles['hide-logo']);\r\n        }\r\n        else\r\n        {\r\n            this.form.classList.remove(styles['hide-logo']);\r\n        }\r\n    }\r\n\r\n    activateStepButtons(){\r\n        if(BX.type.isDomNode(this.currentFormStep)){\r\n            const buttons = this.currentFormStep.querySelectorAll(\r\n                `.${styles['appointment-form-button']}:not([data-readonly=\"Y\"])`\r\n            );\r\n            buttons.length && buttons.forEach(button => button.removeAttribute('disabled'))\r\n        }\r\n    }\r\n\r\n    deactivateStepButtons(){\r\n        if(BX.type.isDomNode(this.currentFormStep)){\r\n            const buttons = this.currentFormStep.querySelectorAll(\r\n                `.${styles['appointment-form-button']}:not([data-readonly=\"Y\"])`\r\n            );\r\n            buttons.length && buttons.forEach(button => button.setAttribute('disabled', true))\r\n        }\r\n    }\r\n\r\n    submit(event) {\r\n        event.preventDefault();\r\n\r\n        if (this.checkRequiredFields())\r\n        {\r\n            this.messageNode ? (this.messageNode.textContent = \"\") : void(0);\r\n            this.toggleLoader(true);\r\n            this.orderData = {...this.filledInputs.textValues};\r\n\r\n            for (let key in this.selectionNodes)\r\n            {\r\n                if(!this.useServices && (key === this.dataKeys.servicesKey)) {\r\n                    continue;\r\n                }\r\n\r\n                if (this.selectionNodes.hasOwnProperty(key) && this.filledInputs.hasOwnProperty(key))\r\n                {\r\n                    this.selectionNodes[key].inputNode.value = JSON.stringify(this.filledInputs[key]);\r\n                    this.orderData = {...this.orderData, ...this.filledInputs[key]};\r\n                }\r\n            }\r\n\r\n            if (this.useConfirmWith !== this.confirmTypes.none){\r\n                this.sendConfirmCode();\r\n            }\r\n            else\r\n            {\r\n                this.sendOrder();\r\n            }\r\n        }\r\n        else\r\n        {\r\n            this.showError(BX.message(\"ANZ_JS_ORDER_CHECK_FIELDS_ERROR\"));\r\n        }\r\n    }\r\n\r\n    sendConfirmCode (event = false) {\r\n        event && event.preventDefault();\r\n\r\n        this.messageNode.textContent = \"\";\r\n\r\n        BX.ajax.runAction('anz:appointment.messageController.sendConfirmCode', {\r\n            data: {\r\n                phone: this.orderData.phone,\r\n                email: this.orderData.email,\r\n                sessid: BX.bitrix_sessid()\r\n            }\r\n        })\r\n            .then(result => {\r\n                this.timeExpires = result.data?.timeExpires ?? ((new Date()).getTime() / 1000).toFixed(0) + 60;\r\n                this.createConfirmationForm();\r\n                this.toggleLoader(false);\r\n            })\r\n            .catch(result => {\r\n                this.messageNode.textContent = result.errors?.[0]?.message + BX.message(\"ANZ_JS_SOME_DISPLAY_ERROR_POSTFIX\");\r\n                this.logResultErrors(result);\r\n                this.toggleLoader(false);\r\n            });\r\n    }\r\n\r\n    createConfirmationForm (){\r\n        this.confirmWrapper && this.confirmWrapper.remove();\r\n        this.confirmWrapper = this.renderer.getConfirmationBlock();\r\n        this.form.classList.add(styles['appointment-form-confirmation-mode']);\r\n        BX.append(this.confirmWrapper, this.form);\r\n    }\r\n\r\n    verifyConfirmCode (code, confirmWarningNode, btnNode)\r\n    {\r\n        if (confirmWarningNode && btnNode){\r\n            confirmWarningNode.textContent = '';\r\n            if (code?.length === 4)\r\n            {\r\n                btnNode.classList.add(styles['loading']);\r\n\r\n                BX.ajax.runAction('anz:appointment.messageController.verifyConfirmCode', {\r\n                    data: {\r\n                        code: code,\r\n                        email: this.orderData.email,\r\n                        sessid: BX.bitrix_sessid()\r\n                    }\r\n                })\r\n                    .then(() => this.sendOrder())\r\n                    .catch(result => {\r\n                        btnNode.classList.remove(styles['loading']);\r\n                        if (result.errors?.length > 0){\r\n                            result.errors.forEach((error) => {\r\n                                confirmWarningNode.innerHTML = ((Number(error.code) === 400) || (Number(error.code) === 406) || (Number(error.code) === 425))\r\n                                    ? `${confirmWarningNode.innerHTML}${error.message}<br>`\r\n                                    : BX.message(\"ANZ_JS_APPLICATION_ERROR\");\r\n                            })\r\n                        }\r\n                    });\r\n            }\r\n            else\r\n            {\r\n                confirmWarningNode.textContent = BX.message(\"ANZ_JS_CONFIRM_CODE_LENGTH\");\r\n            }\r\n        }\r\n    }\r\n\r\n    sendOrder() {\r\n        BX.ajax.runAction('anz:appointment.oneCController.addOrder', {\r\n            data: {\r\n                params: JSON.stringify(this.orderData),\r\n                sessid: BX.bitrix_sessid()\r\n            }\r\n        })\r\n            .then((result) => {\r\n                this.destroyConfirmationForm();\r\n                this.toggleLoader(false);\r\n\r\n                if (result.data?.error)\r\n                {\r\n                    throw new Error(result.data.error);\r\n                }\r\n                else\r\n                {\r\n                    if (this.useEmailNote && this.orderData.email)\r\n                    {\r\n                        this.sendEmailNote();\r\n                    }\r\n                    this.finalizingWidget(true);\r\n                }\r\n            })\r\n            .catch(result => {\r\n                this.destroyConfirmationForm();\r\n                this.toggleLoader(false);\r\n                this.logResultErrors(result);\r\n                this.finalizingWidget(false);\r\n            });\r\n    }\r\n\r\n    sendEmailNote() {\r\n        BX.ajax.runAction('anz:appointment.messageController.sendEmailNote', {\r\n            data: {\r\n                params: JSON.stringify(this.orderData),\r\n                sessid: BX.bitrix_sessid()\r\n            }\r\n        }).then().catch();\r\n    }\r\n\r\n    startCodeTimerActions(confirmRepeatBtn: HTMLElement){\r\n        const curTimeSeconds: number = Number(((new Date()).getTime() / 1000).toFixed(0));\r\n        let remainingTime = this.timeExpires - curTimeSeconds;\r\n        const interval = setInterval(() => {\r\n            if (remainingTime <= 0)\r\n            {\r\n                EventManager.bind(confirmRepeatBtn, 'click', this.sendConfirmCode.bind(this));\r\n                clearInterval(interval);\r\n            }\r\n            else\r\n            {\r\n                remainingTime--;\r\n                confirmRepeatBtn.textContent = `${BX.message(\"ANZ_JS_CONFIRM_CODE_SEND_AGAIN\")} \r\n                                                ${remainingTime > 0 ? remainingTime : ''}`;\r\n            }\r\n        }, 1000);\r\n    }\r\n\r\n    destroyConfirmationForm(){\r\n        this.confirmWrapper && this.confirmWrapper.remove();\r\n        this.form.classList.remove(styles['appointment-form-confirmation-mode']);\r\n    }\r\n\r\n    finalizingWidget(success) {\r\n        this.resultBlock.classList.add(styles['active']);\r\n        this.form.classList.add(styles['off']);\r\n\r\n        const resTextNode = this.resultBlock.querySelector('p');\r\n        if (resTextNode)\r\n        {\r\n            if (success)\r\n            {\r\n                const date = this.convertDateToDisplay(this.orderData.timeBegin, false);\r\n                const time = this.convertDateToDisplay(this.orderData.timeBegin, true);\r\n                const doctor = this.orderData.doctorName;\r\n                resTextNode.innerHTML = `${BX.message(\"ANZ_JS_APPOINTMENT_SUCCESS\")}\r\n                                         <br>${date} ${time}\r\n                                         <br>${BX.message(\"ANZ_JS_APPOINTMENT_DOCTOR\")} - ${doctor}` ;\r\n                resTextNode.classList.add(styles['success']);\r\n                this.finalAnimations();\r\n            }\r\n            else\r\n            {\r\n                resTextNode.append(this.createFinalError());\r\n                resTextNode.classList.add(styles['error']);\r\n                setTimeout(()=>{\r\n                    this.reload();\r\n                }, 5000);\r\n            }\r\n        }\r\n    }\r\n\r\n    finalAnimations(){\r\n        this.startBtn.classList.remove(styles['active']);\r\n        this.startBtn.classList.add(styles['success']);\r\n        setTimeout(()=>{\r\n            this.reload();\r\n        }, 5000);\r\n    }\r\n\r\n    reload(event = false){\r\n        event && event.preventDefault();\r\n        this.overlay.classList.remove(styles['active']);\r\n        this.firstInit = false;\r\n        this.loaded    = false;\r\n        setTimeout(this.run.bind(this), 500);\r\n    }\r\n\r\n    createFinalError () {\r\n        return BX.create('p', {\r\n            children: [\r\n                BX.create('span', {\r\n                    html: BX.message('ANZ_JS_APPOINTMENT_FINAL_ERROR_START')\r\n                }),\r\n                BX.create('a', {\r\n                    attrs: {\r\n                        href: \"#\"\r\n                    },\r\n                    text: BX.message('ANZ_JS_APPOINTMENT_FINAL_ERROR_LINK'),\r\n                    events: {\r\n                        click: (e) => this.reload(e)\r\n                    }\r\n                }),\r\n                BX.create('span', {\r\n                    html: BX.message('ANZ_JS_APPOINTMENT_FINAL_ERROR_END')\r\n                })\r\n            ]\r\n        });\r\n    }\r\n\r\n    checkRequiredFields(){\r\n        let allNotEmpty = true;\r\n\r\n        if (this.requiredInputs.length > 0){\r\n            this.requiredInputs.some((input) => {\r\n                if (!BX.type.isNotEmptyString(input['value']))\r\n                {\r\n                    allNotEmpty = false;\r\n                    input.parentElement?.classList.add(styles['error'])\r\n                    return true;\r\n                }\r\n                else\r\n                {\r\n                    input.parentElement?.classList.remove(styles['error']);\r\n                }\r\n            });\r\n        }\r\n        return allNotEmpty && this.phoneIsValid(this.textNodes.phone.inputNode);\r\n    }\r\n\r\n    phoneIsValid(phoneInput){\r\n        const phone = phoneInput.value;\r\n        let isValid = !( !phone || (phone.length !== this.phoneMask.length) );\r\n        if (phoneInput.parentElement !== null){\r\n            !isValid\r\n                ? phoneInput.parentElement.classList.add(styles[\"error\"])\r\n                : phoneInput.parentElement.classList.remove(styles[\"error\"]);\r\n        }\r\n        return isValid;\r\n    }\r\n\r\n    /**\r\n     * add input mask to all inputs with type=tel\r\n     */\r\n    addPhoneMasks(){\r\n        const maskedInputs = this.overlay.querySelectorAll('input[type=\"tel\"]');\r\n        maskedInputs.length && maskedInputs.forEach((input: HTMLInputElement) => {\r\n            input.addEventListener('input', (e) => {\r\n                maskInput(e.currentTarget, this.phoneMask);\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * add BX.calendar extension to select birthday date on related input\r\n     */\r\n    addCalendarSelection(){\r\n        const that = this;\r\n        const birthdayInput = this.overlay.querySelector('input[name=\"birthday\"]');\r\n        birthdayInput.addEventListener('keydown', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n        birthdayInput.addEventListener('click', () => {\r\n            BX.calendar({\r\n                node: birthdayInput,\r\n                field: birthdayInput,\r\n                bTime: false,\r\n                callback_after: function(date){\r\n                    const timestamp = (new Date(date)).getTime();\r\n                    that.filledInputs.textValues.birthday = that.convertDateToISO(timestamp);\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * inject styles with custom color variables from module settings\r\n     */\r\n    addCustomColors(){\r\n        if (Object.keys(this.customColors).length > 0)\r\n        {\r\n            const style = BX.create('style');\r\n            style.textContent = `.${styles['appointment-popup-overlay']}, .${styles['appointment-button-wrapper']}{`\r\n            for (let key in this.customColors){\r\n                if (this.customColors.hasOwnProperty(key))\r\n                {\r\n                    switch (key) {\r\n                        case \"--appointment-main-color\":\r\n                            const hslM = convertHexToHsl(this.customColors[key]);\r\n                            if (hslM){\r\n                                style.textContent += `--main-h: ${hslM.h};--main-s: ${hslM.s};--main-l: ${hslM.l};`;\r\n                            }\r\n                            break;\r\n                        case \"--appointment-field-color\":\r\n                            const hslF = convertHexToHsl(this.customColors[key]);\r\n                            if (hslF){\r\n                                style.textContent += `-field-h: ${hslF.h};--field-s: ${hslF.s};--field-l: ${hslF.l};`;\r\n                            }\r\n                            break;\r\n                        default:\r\n                            style.textContent += `${key}: ${this.customColors[key]};`;\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n            style.textContent = style.textContent + `}`;\r\n            this.overlay.after(style);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * show/hide popup with appointment form and starts loading data from 1c on first showing\r\n     */\r\n    togglePopup() {\r\n        this.overlay.classList.toggle(styles['active']);\r\n        this.useCustomMainBtn ? this.startBtn.classList.toggle('active')\r\n            : this.startBtn.classList.toggle(styles['active']);\r\n        if (!this.loaded){\r\n            this.start();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * toggle load animation on form\r\n     * @param on\r\n     */\r\n    toggleLoader(on = true){\r\n        on  ? this.form.classList.add(styles['loading'])\r\n            : this.form.classList.remove(styles['loading'])\r\n    }\r\n\r\n    /**\r\n     * convert date to ISO format without seconds\r\n     * @param timestamp\r\n     * @returns {string}\r\n     */\r\n    convertDateToISO (timestamp) {\r\n        const date = this.readDateInfo(timestamp);\r\n\r\n        return `${date.year}-${date.month}-${date.day}T${date.hours}:${date.minutes}:00`;\r\n    }\r\n\r\n    /**\r\n     * convert date to format \"d-m-Y\" / \"d.m.Y\" / \"H:i\"\r\n     * @param timestamp\r\n     * @param onlyTime\r\n     * @param onlyDate\r\n     * @returns {string}\r\n     */\r\n    convertDateToDisplay (timestamp, onlyTime = false, onlyDate = false) {\r\n        const date = this.readDateInfo(timestamp);\r\n\r\n        if (onlyTime){\r\n            return `${date.hours}:${date.minutes}`;\r\n        }\r\n        if (onlyDate){\r\n            return `${date.day}.${date.month}.${date.year}`;\r\n        }\r\n        return `${date.day}-${date.month}-${date.year}`;\r\n    }\r\n\r\n    /**\r\n     * convert param to object with detail info about date\r\n     * @param timestampOrISO\r\n     * @returns {{hours: string, seconds: string, month: string, year: number, minutes: string, weekDay, day: string}}\r\n     */\r\n    readDateInfo(timestampOrISO){\r\n        const date = new Date(timestampOrISO);\r\n\r\n        let day = `${date.getDate()}`;\r\n        if (Number(day)<10) {\r\n            day = `0${day}`;\r\n        }\r\n\r\n        let month = `${date.getMonth()+1}`;\r\n        if (Number(month)<10) {\r\n            month = `0${month}`;\r\n        }\r\n\r\n        let hours = `${date.getHours()}`;\r\n        if (Number(hours)<10) {\r\n            hours = `0${hours}`;\r\n        }\r\n\r\n        let minutes = `${date.getMinutes()}`;\r\n        if (Number(minutes)<10) {\r\n            minutes = `0${minutes}`;\r\n        }\r\n\r\n        let seconds = `${date.getSeconds()}`;\r\n        if (Number(seconds)<10) {\r\n            seconds = `0${seconds}`;\r\n        }\r\n\r\n        return {\r\n            \"day\": day,\r\n            \"month\": month,\r\n            \"year\": date.getFullYear(),\r\n            \"hours\": hours,\r\n            \"minutes\": minutes,\r\n            \"seconds\": seconds,\r\n            \"weekDay\": this.ucFirst(date.toLocaleString('ru', {weekday: 'short'}))\r\n        }\r\n    }\r\n\r\n    /**\r\n     * make the first letter of a string uppercase\r\n     * @param str\r\n     * @returns {string|*}\r\n     */\r\n    ucFirst(str) {\r\n        if (!str) return str;\r\n\r\n        return str[0].toUpperCase() + str.slice(1);\r\n    }\r\n\r\n    /**\r\n     * error logging\r\n     * @param res\r\n     */\r\n    logResultErrors(res) {\r\n        if (res.errors && Array.isArray(res.errors) && res.errors.length > 0)\r\n        {\r\n            res.errors.forEach(error => {\r\n                console.log(`${BX.message(\"ANZ_JS_APPLICATION_ERROR\")} - ${error.message}`)\r\n            })\r\n        }\r\n        else\r\n        {\r\n            console.log(BX.message(\"ANZ_JS_APPLICATION_ERROR\") + \"\\r\\n\", res.message ?? res);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * init elements selectors\r\n     * @param stylesObject\r\n     * @returns object\r\n     */\r\n    getAppSelectors(stylesObject)\r\n    {\r\n        return {\r\n            rootNodeId:         'anz-appointment-application-root',\r\n            overlayId:          'appointment-popup-steps-overlay',\r\n            startBtnWrapId:     stylesObject['appointment-button-wrapper'],\r\n            startBtnId:         stylesObject['appointment-button'],\r\n            formId:             stylesObject['appointment-form'],\r\n            mobileCloseBtnId:   stylesObject['appointment-form-close'],\r\n            messageNodeId:      stylesObject['appointment-form-message'],\r\n            submitBtnId:        stylesObject['appointment-form-button'],\r\n            appResultBlockId:   stylesObject['appointment-result-block'],\r\n            inputClass:         stylesObject['appointment-form_input'],\r\n            textareaClass:      stylesObject['appointment-form_textarea'],\r\n            confirmWrapperId:   stylesObject['appointment-form-confirmation-wrapper'],\r\n            formStepIds: {\r\n                one:        'appointment-form-step-one',\r\n                two:        'appointment-form-step-two',\r\n                userData:   'appointment-form-step-userData',\r\n            }\r\n        }\r\n    }\r\n\r\n    showError(message) {\r\n        if (this.messageNode){\r\n            this.messageNode.textContent = message;\r\n        }\r\n        else {\r\n            this.logResultErrors(message);\r\n        }\r\n    }\r\n\r\n    alertError(message) {\r\n        const that = this;\r\n        MessageBox.show(\r\n            {\r\n                message: message,\r\n                modal: true,\r\n                buttons: MessageBoxButtons.OK,\r\n                onOk: function(messageBox)\r\n                {\r\n                    that.reload();\r\n                    messageBox.close();\r\n                }\r\n            }\r\n        );\r\n    }\r\n\r\n    processLoadDataError(e) {\r\n        !this.useCustomMainBtn && this.startBtnWrap.classList.add(styles['hidden']);\r\n        this.logResultErrors(e);\r\n        this.alertError(BX.message(\"ANZ_JS_APPLICATION_ERROR_CONNECTION\"));\r\n    }\r\n}","/**\n * ==================================================\n * Developer: Alexey Nazarov\n * E-mail: jc1988x@gmail.com\n * Copyright (c) 2019 - 2022\n * ==================================================\n * \"Bit.Umc - Bitrix integration\" - index.js\n * 10.07.2022 23:48\n * ==================================================\n */\n'use strict';\nimport {AppointmentSteps} from './appointment/app';\n\nBX.ajax.runComponentAction('anz:appointment.add', 'getResult', {\n    mode: 'ajax',\n    data: {\n        sessid: BX.bitrix_sessid()\n    }\n})\n.then(function (response)\n{\n    const AppPlace = BX.namespace('Anz.Appointment');\n    AppPlace.AppointmentSteps = new AppointmentSteps(response.data);\n    AppPlace.AppointmentSteps.run();\n})\n.catch(function (e)\n{\n    if (e.errors && BX.type.isArray(e.errors))\n        {\n            let errorText = '';\n            e.errors.forEach(error => {\n                errorText = `${errorText} ${error.code} - ${error.message};`;\n            })\n            console.log(errorText)\n        }\n        else\n        {\n            console.log('app data loading error', e);\n        }\n});"],"names":["maskInput","input","mask","value","literalPattern","numberPattern","newValue","valueIndex","i","length","test","convertHexToHsl","hex","result","exec","r","parseInt","g","b","max","Math","min","h","s","l","d","round","EventManager","target","eventName","handler","options","Event","bind","EventEmitter","Renderer","styles","application","BX","create","attrs","id","selectors","overlayId","className","children","formId","getLogoBlock","getCloseButton","getFormFirstBlock","getFormSecondBlock","getFormUserDataBlock","getFormMessageBlock","getFormPrivacyBlock","getFormResultBlock","getFormLoaderBlock","companyLogo","src","alt","html","doctorBtn","getFormBtn","message","setSelectionDoctorBeforeService","serviceBtn","buttons","useServices","formStepIds","one","dataset","services","getSelectionNodes","dataKeys","clinicsKey","specialtiesKey","getFormButtonsBlock","btnPrev","changeFormStep","formStepNodes","btnNext","userData","two","employeesKey","servicesKey","scheduleKey","getTextNodes","getFormSubmitBtn","messageNodeId","type","submitBtnId","text","disabled","readonly","events","click","href","initParams","appResultBlockId","blockKeys","arNodes","forEach","key","selectionBlocks","hasOwnProperty","selected","selectedId","defaultText","toggleSelectionList","list","listId","inputId","name","additionalClass","push","blockId","tag","getTextInputAttrs","preparedAttrs","attr","startBtnWrapId","startBtnId","rootNodeId","listNode","dataKey","items","allowToRender","renderScheduleItem","price","Number","fullName","dataAttrs","uid","duration","append","createEmptySelectionNode","toUpperCase","addHorizontalScrollButtons","addItemActions","scheduleList","scheduleItem","serviceDuration","getServiceDuration","renderCustomIntervals","timeKey","Object","keys","days","dayIntervals","date","Array","isArray","getIntervalsForServiceDuration","renderColumn","createDayColumn","interval","displayDate","start","timeBegin","end","timeEnd","day","readDateInfo","weekDay","scroller","item","querySelector","itemWidth","clientWidth","scrollLeft","scrollBy","left","top","behavior","scrollTo","scrollWidth","confirmWarningNode","placeholder","useConfirmWith","confirmTypes","email","confirmInputNode","required","autocomplete","e","substring","confirmSubmitBtn","verifyConfirmCode","confirmRepeatBtn","confirmWrapper","confirmWrapperId","style","startCodeTimerActions","TextInputNames","middleName","surname","phone","birthday","comment","AppointmentSteps","params","firstInit","getAppSelectors","selectionSteps","values","useTimeSteps","timeStepDurationMinutes","strictCheckingOfRelations","showDoctorsWithoutDepartment","useEmailNote","useCustomMainBtn","customColors","filledInputs","clinicUid","clinicName","specialty","specialtyUid","serviceUid","serviceName","refUid","doctorName","orderDate","textValues","address","prepareSelectionBlocksForRender","renderer","step","checkRoot","insertAppHtml","init","root","isDomNode","getRootElement","document","body","cleanNode","getAppHtmlSkeleton","getDefaultStartBtn","initCustomEvents","initFormStepNodes","initStartBtn","initBaseNodes","initOverlayAction","initForm","initMobileCloseBtn","initSelectionNodes","initTextNodes","addPhoneMasks","addCalendarSelection","addCustomColors","logResultErrors","subscribe","clinicsLoaded","loaded","renderBlock","clinicsRendered","createSpecialtiesList","toggleLoader","formStepChanged","data","isBack","selectionStep","changeFormStepActions","activateSelectionNodes","currentFormStep","startBtn","togglePopup","Error","overlay","startBtnWrap","mobileCloseBtn","mobileCloseBtnId","messageNode","submitBtn","resultBlock","getAttribute","form","submit","selectionNodes","blockNode","selectedNode","inputNode","isRequired","requiredInputs","block","currentValue","Date","convertDateToDisplay","getTime","val","phoneMask","textNodes","getListClinic","ajax","runAction","sessid","bitrix_sessid","then","clinicsResponse","error","clinics","emit","processLoadDataError","employeesResponse","employees","employeesLoaded","employeeUid","clinicGuid","employeeGuid","scheduleResponse","schedule","textContent","scheduleLoaded","nomenclature","bindServicesToSpecialties","servicesStorage","renderSpecialtiesList","classList","add","selectedClinic","selectedSpecialtyUid","selectedEmployeeUid","renderSelectionItems","canRender","selectedServiceUid","clinicCondition","specialtyCondition","alreadyRendered","includes","isNotEmptyString","selectDoctorBeforeService","selectedEmployee","selectedEmployeeFullData","selectedService","personalDuration","intervals","serviceDurationMs","newIntervals","timestampTimeBegin","timestampTimeEnd","timeDifference","appointmentsCount","floor","convertDateToISO","setMinutes","getMinutes","toggle","nodesKey","remove","times","querySelectorAll","time","addEventListener","stopPropagation","innerHTML","currentTarget","changeSelectionStep","activateStepButtons","getListEmployees","getListNomenclature","renderScheduleList","renderEmployeesList","getSchedule","renderServicesList","empServices","empServiceUid","addSpecialty","employee","addClinicToSpecialty","current","next","resetValue","selectedSpecialty","selectedDate","dateCondition","deactivateStepButtons","propKey","insertBefore","BaseEvent","previousStep","newStep","checkRequiredFields","nextStep","button","removeAttribute","setAttribute","event","preventDefault","orderData","JSON","stringify","none","sendConfirmCode","sendOrder","showError","timeExpires","toFixed","createConfirmationForm","errors","getConfirmationBlock","code","btnNode","destroyConfirmationForm","sendEmailNote","finalizingWidget","curTimeSeconds","remainingTime","setInterval","clearInterval","success","resTextNode","doctor","finalAnimations","createFinalError","setTimeout","reload","run","allNotEmpty","some","parentElement","phoneIsValid","phoneInput","isValid","maskedInputs","that","birthdayInput","calendar","node","field","bTime","callback_after","timestamp","hslM","hslF","after","on","year","month","hours","minutes","onlyTime","onlyDate","timestampOrISO","getDate","getMonth","getHours","seconds","getSeconds","getFullYear","ucFirst","toLocaleString","weekday","str","slice","res","console","log","stylesObject","inputClass","textareaClass","MessageBox","show","modal","MessageBoxButtons","OK","onOk","messageBox","close","alertError","runComponentAction","mode","response","AppPlace","namespace","errorText"],"mappings":"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"}